import{RenderTarget as o}from"framer";import{createElement as f,useEffect as h,useState as I}from"react";class a{storageKey="framercart";listeners={};addListener(t,n){this.listeners[t]?this.listeners[t].push(n):this.listeners[t]=[n]}removeListener(t,n){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(i=>i!==n))}dispatchEvent(t,n){if(this.listeners[t])for(const i of this.listeners[t])i(n)}get items(){try{return JSON.parse(localStorage.getItem(this.storageKey))||[]}catch{return[]}}set items(t){try{localStorage.setItem(this.storageKey,JSON.stringify(t))}catch{}}addItem(t){this.items.findIndex(i=>i.key===t.key)==-1&&(this.items=[...this.items,t]),this.dispatchEvent("#"+t.key,t),this.dispatchEvent("change",this.items)}removeItem(t){this.items=this.items.filter(n=>n.key!==t),this.dispatchEvent("#"+t),this.dispatchEvent("change",this.items)}containsItem(t){return this.items.some(n=>n.key===t)}getItem(t){return this.items.find(n=>n.key===t)}updateItemCount(t,n){const i=this.items.findIndex(c=>c.key===t);if(i===-1)return;const r=this.items[i],s=r.count+n;if(s<1){this.removeItem(r.key);return}const u={...r,count:s};this.items=this.items.map(c=>c.key===r.key?u:c),this.dispatchEvent("#"+r.key,u),this.dispatchEvent("change",this.items)}clear(){localStorage.removeItem(this.storageKey),this.dispatchEvent("change",this.items)}static t;static get Instance(){return a.t||(a.t=new a),this.t}}const m={isInCanvas:function(){return o.current()===o.canvas},useOnChange:function(e){h(()=>{if(!m.isInCanvas())return e(a.Instance.items),a.Instance.addListener("change",e),()=>{a.Instance.removeListener("change",e)}},[])},useOnItemChange:function(e,t){h(()=>{if(!(!t||m.isInCanvas())){if(t){const n=a.Instance.items.find(i=>i.key===t);e(n)}return a.Instance.addListener("#"+t,e),()=>{a.Instance.removeListener("#"+t,e)}}},[t])},useVisibility:function(e,t){const[n,i]=I(!1);return m.useOnItemChange(r=>{if(e==="in"||e==="notin"){const s=!!r;i(e==="in"?s:!s)}},t),m.useOnChange(r=>{if(e==="empty"||e==="notempty"){const s=r.length===0;i(e==="empty"?s:!s)}}),n},renderWarn:function(e,t){return f("div",{style:{...t,color:"#f36",border:"1px solid #f36",padding:"8px",whiteSpace:"nowrap",borderRadius:"8px"}},e)},formatNumber:function(e,t){const n=Math.max(e.minInt||1,1),i=e.minFrac||0,r=Math.max(e.maxFrac||0,i);let s=(t||0).toLocaleString(void 0,{minimumIntegerDigits:n,minimumFractionDigits:i,maximumFractionDigits:r});return e.prefix&&(s=e.prefix+s),e.suffix&&(s=s+e.suffix),s},calculateRaw:function(e,t,n){try{const i=e.replace(/[^0-9+\-*/().pq]/g,"").trim();return i?d(i,t,n):0}catch{return 0}},calculateValue:function(e,t,n,i){return m.formatNumber(t,m.calculateRaw(e,n,i))}};function d(e,t,n){return new Function("p","q",`return ${e};`)(t,n)}export{a as Cart,m as Funcs};