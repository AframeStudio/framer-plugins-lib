import{RenderTarget as h}from"framer";import{createElement as I,useEffect as f,useState as d}from"react";class r{storageKey="framercart";listeners={};addListener(t,n){this.listeners[t]?this.listeners[t].push(n):this.listeners[t]=[n]}removeListener(t,n){this.listeners[t]&&(this.listeners[t]=this.listeners[t].filter(i=>i!==n))}dispatchEvent(t,n){if(this.listeners[t])for(const i of this.listeners[t])i(n)}get items(){try{return JSON.parse(localStorage.getItem(this.storageKey))||[]}catch{return[]}}set items(t){try{localStorage.setItem(this.storageKey,JSON.stringify(t))}catch{}}addItem(t){this.items.findIndex(i=>i.key===t.key)==-1&&(this.items=[...this.items,t]),this.dispatchEvent("#"+t.key,t),this.dispatchEvent("change",this.items)}removeItem(t){this.items=this.items.filter(n=>n.key!==t),this.dispatchEvent("#"+t),this.dispatchEvent("change",this.items)}containsItem(t){return this.items.some(n=>n.key===t)}getItem(t){return this.items.find(n=>n.key===t)}updateItemCount(t,n,i){const a=this.items.findIndex(c=>c.key===t);if(a===-1)return;const s=this.items[a],u=i?n:s.count+n;if(u<1){this.removeItem(s.key);return}const o={...s,count:u};this.items=this.items.map(c=>c.key===s.key?o:c),this.dispatchEvent("#"+s.key,o),this.dispatchEvent("change",this.items)}clear(){localStorage.removeItem(this.storageKey),this.dispatchEvent("change",this.items)}static t;static get Instance(){return r.t||(r.t=new r),this.t}}const m={isInCanvas:function(){return h.current()===h.canvas},useOnChange:function(e){f(()=>{if(!m.isInCanvas())return e(r.Instance.items),r.Instance.addListener("change",e),()=>{r.Instance.removeListener("change",e)}},[])},useOnItemChange:function(e,t){f(()=>{if(!(!t||m.isInCanvas())){if(t){const n=r.Instance.items.find(i=>i.key===t);e(n)}return r.Instance.addListener("#"+t,e),()=>{r.Instance.removeListener("#"+t,e)}}},[t])},useVisibility:function(e,t){const[n,i]=d(!1);return m.useOnItemChange(a=>{if(e==="in"||e==="notin"){const s=!!a;i(e==="in"?s:!s)}},t),m.useOnChange(a=>{if(e==="empty"||e==="notempty"){const s=a.length===0;i(e==="empty"?s:!s)}}),n},renderWarn:function(e,t){return I("div",{style:{...t,color:"#f36",border:"1px solid #f36",padding:"8px",whiteSpace:"nowrap",borderRadius:"8px"}},e)},formatNumber:function(e,t){const n=Math.max(e.minInt||1,1),i=e.minFrac||0,a=Math.max(e.maxFrac||0,i);let s=(t||0).toLocaleString(void 0,{minimumIntegerDigits:n,minimumFractionDigits:i,maximumFractionDigits:a});return e.prefix&&(s=e.prefix+s),e.suffix&&(s=s+e.suffix),s},calculateRaw:function(e,t,n){try{const i=e.replace(/[^0-9+\-*/().pq]/g,"").trim();return i?g(i,t,n):0}catch{return 0}},calculateValue:function(e,t,n,i){return m.formatNumber(t,m.calculateRaw(e,n,i))}};function g(e,t,n){return new Function("p","q",`return ${e};`)(t,n)}export{r as Cart,m as Funcs};